require 'scraperwiki'
require 'json'
require 'open-uri'

scrapers = %w(ballina_shire_council_development_applications bankstown_development_applications bellingen-shire-council-development-applications blacktown_city_council_development_applications blue-mountains-city-council-development-applicatio bundaberg_regional_council_development_application campbelltown_city_council_development_proposals charters_towers_regional_council_development_appli city_of_ballarat_development_applications city_of_burnside_development_applications city_of_cockburn_development_applications city_of_greater_geelong_development_applications city_of_kingston_development_applications city_of_marion_development_applications city_of_melbourne_planning_applications city_of_ryde_development_applications city_of_stonnington_development_applications city_of_sydney_development_applications city_of_unley_development_applications city_of_vincent_wa_development_applications clarence_city_council_development_applications coffs_harbour_city_council_development_application development_assessment_panel_applications fairfield_city_development_applications gold_coast_city_council_development_applications gosford_nsw_development_applications greater_taree_council_development_applications hawkesbury_city_council_development_applications hobart_city_council_development_applications knox_regional_council_development_applications lane_cove_da_scraper leichhardt_municipal_council_development_applicati mackay_city_council_development_applications marrickville-council-development-applications moreton_bay_regional_council_development_applicati mornington_peninsula_shire_-_development_applicati mosman_council_development_applications muswellbrook_shire_council_development_application nillumbik_shire_council_development_applications north_sydney_council_development_applications northern_territory_development_applications nsw_department_of_planning_major_project_assessmen nsw_joint_regional_planning_panels_development_reg nsw_office_of_liquor_gaming_and_racing_-_liquor_ap onkaparinga_sa_development_applications parramatta-city-council-development-applications penrith_city_council_development_applications perth_development_applications pittwater_council_development_applications port_stephens_development_applications randwick_city_council_development_applications rockdale_city_council_development_applications_-_r scenic_rim_regional_council_development_applicatio shire_of_yarra_ranges_planning_applications shoalhaven_council_development_applications singleton_council_development_applications streamlined_planning_through_electronic_applicatio sunshine_coast_council_development_applications surf_coast_shire_council_development_applications the_hills_shire_council_development_applications toowoomba_city_council_planning_and_development_ap townsville_city_council_development_applications victorian_liquor_licence_applications_1 waverley_council_development_applications willoughby_da_scraper_1 woollahra_council_development_applications yarra_city_development_applications)

scrapers.each do |scraper_name|
  url = "http://api.scraperwiki.com/api/1.0/scraper/getinfo?format=jsondict&version=-1&quietfields=code%7Crunevents%7Cdatasummary%7Cuserroles%7Chistory&name=#{scraper_name}"
  scraper_info = JSON.parse(open(url).read).first
  ScraperWiki.save_sqlite([:short_name], {short_name: scraper_info['short_name'],
                                          langauage: scraper_info['language'],
                                          title: scraper_info['title']})
end
